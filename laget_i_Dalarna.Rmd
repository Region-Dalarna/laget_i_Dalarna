---
title: "Läget i Dalarna"
author: ""
date: ""
output: 
  html_document:
    includes:
      in_header: hero_image.html
    toc: yes
    toc_float: yes
    toc_depth: 6
    css: "styles_hero.css"
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.height=5, fig.width=8, fig.align='center')

# Paket som används
if (!require("pacman")) install.packages("pacman")
p_load(sf,
       here,
       openxlsx,
       tidyverse,
       mapview,
       leafpop,
       plotly,
       tidytext)

# Läser in funktioner
source("https://raw.githubusercontent.com/Region-Dalarna/funktioner/main/func_SkapaDiagram.R")
source("https://raw.githubusercontent.com/Region-Dalarna/funktioner/main/func_API.R")

# Skapar en mapp för att 
output_mapp <- here("Figurer","/")

# Om man vill uppdatera den externa hemsidan sätts denna variabel till TRUE
uppdatera_hemsida = FALSE

# Om man vill att figurerna skall sparas vid "knittning" så sätts variabeln nedan till true
spara_figur = FALSE

# Läser in data
barometern_df <- read.xlsx(here("Data","konjunkturbarometern.xlsx"),sheet=1)
BNP_df <- read.xlsx(here("Data","BNP.xlsx"),sheet=1)
KPI_df <- read.xlsx(here("Data","KPI.xlsx"))
varsel_manad_df <- read.xlsx(here("Data","varsel_manad.xlsx"),sheet=1)
varsel_bransch_df <- read.xlsx(here("Data","varsel_bransch_manad.xlsx"),sheet=1)
priser_df <- read.xlsx(here("Data","smahuspriser.xlsx"))
konkurser_df <- read.xlsx(here("Data","konkurser_korrekt.xlsx"),sheet=2)
arbetsmarknadsstatus_lan <- read.xlsx(here("Data","arbetsmarknadsstatus_lan.xlsx"))
arbetsmarknadsstatus_tidsserie <- read.xlsx(here("Data","arbetsmarknadsstatus_tidsserie.xlsx"))
arbetsloshet_kommun <-  read.xlsx(here("Data","arbetsloshet_kommun.xlsx"))

Husbyggande_df <- read.xlsx(here("Data","byggande.xlsx"),sheet=1)%>% 
    mutate(kvartal=ifelse(kvartal=="K1","kvartal ett",
                          ifelse(kvartal=="K2","kvartal två",
                                 ifelse(kvartal=="K3","kvartal tre","kvartal fyra"))))
Bygglov_df <- read.xlsx(here("Data","byggande.xlsx"),sheet=2)%>% 
    mutate(kvartal=ifelse(kvartal=="K1","kvartal ett",
                          ifelse(kvartal=="K2","kvartal två",
                                 ifelse(kvartal=="K3","kvartal tre","kvartal fyra"))))

########### Data som inte uppdateras automatiskt

# Källa: https://sdb.socialstyrelsen.se/if_ekb_manad/resultat.aspx
# Uppdateras genom att hämta en ny version av data
ekonomiskt_bistand_df <-  read.xlsx(here("Data","Socialstyrelsen_2024_02_12.xlsx"),startRow = 2) %>% 
  filter(År>2017,Antal.hushåll>0)
# Källa: https://statistik.tillvaxtanalys.se/PxWeb/pxweb/sv/Tillv%C3%A4xtanalys%20statistikdatabas/
# Uppdateras genom att hämta hem ny data
nystartade_df <-  read.xlsx(here("Data","Tillvaxtananalys_2024_01_11.xlsx"),startRow = 3)

# Källa: https://foretagsinfo.bolagsverket.se/sok-foretagsinformation-web/statistik
antal_avregistreringar_df <- read.csv("C:/Users/frkjon/Projekt/laget_i_Dalarna/Data/Bolagsverket_2024_02_12.csv",encoding="UTF-8") %>% 
  pivot_longer(4:ncol(.),names_to = "variabel",values_to = "value") %>% 
    group_by(År,Månad) %>% 
      summarize(antal = sum(value)) %>% 
        mutate(Månad = ifelse(nchar(as.character(Månad)) == 1,paste0("0",Månad),Månad),
               ar_manad = paste0(År,"-",Månad))
```

```{js}
// The debounce function receives our function as a parameter
const debounce = (fn) => {

  // This holds the requestAnimationFrame reference, so we can cancel it if we wish
  let frame;

  // The debounce function returns a new function that can receive a variable number of arguments
  return (...params) => {
    
    // If the frame variable has been defined, clear it now, and queue for next frame
    if (frame) { 
      cancelAnimationFrame(frame);
    }

    // Queue our function call for the next frame
    frame = requestAnimationFrame(() => {
      
      // Call our function and pass any params we received
      fn(...params);
    });

  } 
};


// Reads out the scroll position and stores it in the data attribute
// so we can use it in our stylesheets
const storeScroll = () => {
  document.documentElement.dataset.scroll = window.scrollY;
}

// Listen for new scroll events, here we debounce our `storeScroll` function
document.addEventListener('scroll', debounce(storeScroll), { passive: true });

// Update scroll position for first time
storeScroll();

```

# Introduktion {-}
<p style = "font-size:12px">
<i>Rapporten är skapad av Samhällsanalys, Region Dalarna<br>
Senast uppdaterad: `r Sys.Date()`</i>
</p>

I Sverige har vi tillgång till mycket god statistik om både våra levnadsförhållanden och vår ekonomi. Det innebär att vi också kan följa upp bland annat den ekonomiska utvecklingen i närtid både regionalt och nationellt till exempel vad gäller sysselsättning, bostadsbyggande och företagsetableringar.
De senaste årens omvälvande händelser i världen med Covid-19-pandemin, det ofattbara kriget i Ukraina, och nu kriget mellan Israel och Hamas är förödande för dem som står i händelsernas centrum, men de drabbar även oss. Dessa händelser sätter prägel på både vår ekonomi och våra levnadsförhållanden, och gör det än mer angeläget att följa den ekonomiska utvecklingen regionalt och nationellt. <br>
<br>
Region Dalarnas samhällsanalytiker har därför tagit fram denna rapport i syfte att ge en nulägesbild över hur läget utvecklas i Dalarna. Rapporten kommer att uppdateras regelbundet. Fokus ligger i första hand på att synliggöra det ekonomiska läget i Dalarna, vad gäller exempelvis hur arbetsmarknad och bostadsbyggande utvecklas i regionen, men många faktorer som påverkar Dalarnas ekonomi är nationella och därför startar analysen med att diskutera läget i Sverige i stort och faktorer som ramar in förutsättningarna för oss som bor och vistas i Dalarna.


# Det allmänna läget i ekonomin
Det allmänna läget i en ekonomi kan beskrivas på flera sätt. I detta första avsnitt har vi valt att fokusera på tre variabler: BNP, konjunkturbarometern och inflation.

## BNP

<details>

  <summary>Mer information om statistiken</summary>

<div title="Källa: SCB">BNP till marknadspris från användningssidan (ENS2010). Data är säsongsrensad och på kvartalsbasis (i fasta priser). BNP är ett mått på den totala ekonomiska aktiviteten i ett land under en tidsperiod.</div>
 
</details>

Genom att titta på förändring i BNP kan man få en uppfattning om hur aktiviteten i den svenska ekonomin förändras över tid. Eftersom Sveriges ekonomi, precis som de flesta andra länders, växer i normala fall, ökar BNP under en majoritet av kvartalen. Vid större kriser i samhället kan dock BNP minska avsevärt, vilket också syns i figuren nedan. Under andra kvartalet 2020 minskade aktiviteten i den svenska ekonomin med nästan 8 procent jämfört med samma kvartal året innan, vilket kan tillskrivas Corona-pandemin. Återhämtningen gick dock snabbt och redan i efteföljande kvartal så ökade BNP med nästan lika mycket som minskningen i kvartal två. Därefter följde ett par år när läget i Sveriges ekonomi kan beskrivas som gott, innan aktiviteten i ekonomin återigen minskade i kvartal ett, år 2022. Därefter har läget varit relativt skakigt och i `r BNP_df %>% filter(ar>"2015") %>% filter(användning =="- BNP till marknadspris") %>% filter(ar_kvartal==last(ar_kvartal)) %>% .$kvartal` `r BNP_df %>% filter(ar>"2015") %>% filter(användning =="- BNP till marknadspris") %>% filter(ar_kvartal==last(ar_kvartal)) %>% .$ar` var förändringen i BNP `r gsub("\\.",",",BNP_df %>% filter(ar>"2015") %>% filter(användning =="- BNP till marknadspris") %>% filter(ar_kvartal==last(ar_kvartal)) %>% .$Sasongsransad_forandring)` procent. Det innebär att aktiviteten i den svenska ekonomin har minskat tre kvartal i rad, och Sverige kan därför sägas vara i en recession.

```{r, include = FALSE}

  diagram_capt <- "Källa: SCBs öppna statistikdatabas.\nBearbetning: Samhällsanalys, Region Dalarna."

  diagramtitel <- paste0("Procentuell förändring i Sveriges BNP jämfört med samma kvartal föregående år")
  diagramtitel <- str_wrap(diagramtitel,40)
  diagramfilnamn <- paste0("BNP.png")

  BNP_stapel <- SkapaStapelDiagram(skickad_df = BNP_df %>% 
                                     filter(ar>"2015") %>% 
                                      filter(användning =="- BNP till marknadspris"),
                                   skickad_x_var = "ar_kvartal", 
                                   skickad_y_var = "Sasongsransad_forandring",
                                   manual_x_axis_text_vjust=1,
                                   manual_x_axis_text_hjust=1,
                                   stodlinjer_avrunda_fem = TRUE,
                                   manual_color = diagramfarger("rus_sex")[1],
                                   diagram_titel = diagramtitel,
                                   x_axis_sort_value = FALSE,
                                   manual_y_axis_title = "procent",
                                   diagram_capt =  diagram_capt,
                                   diagram_facet = FALSE,
                                   output_mapp = "",
                                   filnamn_diagram = diagramfilnamn,
                                   skriv_till_diagramfil = spara_figur)
  
```

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=8, fig.align='center'}
BNP_stapel
```

## Konjunkturbarometern{.tabset}
Ett annat sätt att mäta läget i ekonomin är genom de olika enkätundersökningar som Konjunkturinstitutet regelbundet genomför, med frågor till företag och hushåll om deras uppfattning om nuläge och förväntningar på den ekonomiska utvecklingen. Svaren vägs samman i en indikator som kallas Konjunkturbarometern. Till skillnad från BNP fokuserar konjunkturbarometern inte enbart på nuläget, utan hushållen och företagen får även svara på frågor som rör framtidsutsikterna. Barometerindikatorn väger samman konfidensindikatorer från svaren i de olika enkäterna och ger varje månad en bild av konjunkturläget i Sveriges ekonomi.
<br>

<details>

  <summary>Mer information om statistiken</summary>

<div title="Källa: Konjunkturinstitutet">Barometerindikatorn sammanfattar konfidensindikatorer för industrisektorn, tjänstesektorn, byggsektorn, detaljhandeln samt hushållen i Sverige. Indikatorerna baseras på enkätsvar från företag om bland annat deras produktion, investeringar och försäljning, men även företagens planer och förväntningar om framtiden, tillsammans med hushållens svar på enkätfrågor om deras ekonomiska situation nu och deras planer och förväntningar för framtiden. Detta sammanfattas i Konjunkturbarometern. Barometerindikatorn kan närmast jämföras med EU-kommissionens Economic Sentiment Indicator (ESI) och har ett medelvärde på 100 och en standardavvikelse på 10. Värden över 100 motsvarar en starkare ekonomi än normalt och värden över 110 en mycket starkare ekonomi än normalt. Värden under 100 respektive under 90 visar en svagare respektive mycket svagare ekonomi än normalt.</div>
 
</details>

### Generellt {-}
I `r last(barometern_df %>% filter(Indikator=="Barometerindikatorn")) %>% .$manad_long` `r last(barometern_df %>% filter(Indikator=="Barometerindikatorn")) %>% .$ar` var barometerindikatorn `r gsub("\\.",",",last(barometern_df %>% filter(Indikator=="Barometerindikatorn")) %>% .$Barometerindikatorn.och.andra.indikatorer)`, vilket indikerar att ekonomin i Sverige var svagare än normalt. Barometerindikatorn ökade dock avsevärt jämfört med de senaste månaderna, då den legat stabilt runt 85. Detta är en indikation på att företagens och hushållens syn på sin ekonomin har förbättrats i Sverige på sistone. Att barometerindikatorn länge haft ett lågt värde kan delvis förklaras av Rysslands invasion av Ukraina och de effekter denna haft på bland annat tillgången på råvaror. Historiskt varierar barometerindikatorn med konjunkturen och större kriser i samhället, såsom finanskrisen 2008/2009 och Coronapandemin 2020/2021, syns tydligt i diagrammet.

```{r, include = FALSE}
  diagram_capt <- "Källa: Konjunkturinstitutet.\nBearbetning: Samhällsanalys, Region Dalarna.\nDiagramförklaring: En indikator över 100 motsvarar en starkare ekonomi än normalt och värden över 110 en mycket starkare ekonomi än normalt.\nEn indikator under 100 respektive under 90 visar en svagare respektive mycket svagare ekonomi än normalt."
# barometern_df[substr(barometern_df$Period,6,7)==last(substr(barometern_df$Period,6,7)),]

  # skapar dataframe vars syfte är att skapa en svart linje i diagrammet
  barometern_jmf_df <- barometern_df %>%
    filter(Indikator == "Barometerindikatorn") %>% 
      mutate(Barometerindikatorn.och.andra.indikatorer = 100,
             "Indikator"="Normalt läge i ekonomin")
    
  barometern_gen_utskrift <- rbind(barometern_df %>% filter(Indikator == "Barometerindikatorn"),barometern_jmf_df)
  
  # Skapa startvärde. Första värde måste ligga inom marginalen 12 månader från sista värde.
  # ar = NULL
  # if(substr(last(barometern_gen_utskrift$Period),6,7)<8){
  #   ar = "1997"}else{
  #     ar = "1996"
  #   }
  # startvarde=paste0(ar,"-",substr(last(barometern_gen_utskrift$Period),6,7))

  diagramtitel <- paste0("Barometerindikatorns utveckling i Sverige mellan ",first(barometern_df$manad_long)," ",first(barometern_df$ar)," och ",last(barometern_df$manad_long)," ",last(barometern_df$ar))
  diagramtitel = str_wrap(diagramtitel,45)
  diagramfilnamn <- paste0("barometern.png")
    
   konj <- SkapaLinjeDiagram(skickad_df = barometern_gen_utskrift,
                              skickad_x_var = "Period", 
                              skickad_y_var = "Barometerindikatorn.och.andra.indikatorer",
                              skickad_x_grupp ="Indikator",
                              berakna_index=FALSE,
                              manual_color = c(diagramfarger("rus_sex")[1],"#000000"),
                              stodlinjer_avrunda_fem = TRUE,
                              manual_y_axis_title="Indikatorvärde",
                              diagram_titel = diagramtitel,
                              diagram_capt =  diagram_capt,
                              output_mapp = output_mapp,
                              visa_var_x_xlabel=24,
                              filnamn_diagram = "diagramfilnamn",
                              skriv_till_diagramfil = FALSE)
   
```

```{r, echo = FALSE, message = FALSE, warning = FALSE}
konj
```

### Bransch {-}

Hur läget i ekonomin uppfattas varierar beroende på om det är företagen eller hushållen som tillfrågas. Hushållen hade en mer pessimistisk syn än företagen på ekonomin i `r last(barometern_df$manad_long)` `r last(barometern_df$ar)`, med en barometerindikator på `r gsub("\\.",",",last(barometern_df$Barometerindikatorn.och.andra.indikatorer[barometern_df$Indikator=="Konfidensindikator hushåll"]))`. Bland branschgrupperna i diagrammet nedan hade `r tolower(gsub( " .*$", "", barometern_df %>%filter(Indikator!="Konfidensindikator hushåll",Indikator!="Barometerindikatorn",Period==last(Period)) %>%  filter(Barometerindikatorn.och.andra.indikatorer==max(Barometerindikatorn.och.andra.indikatorer)) %>% .$Indikator))`n den mest positiva synen på ekonomin i `r last(barometern_df$manad_long)` `r last(barometern_df$ar)`, medan företag inom `r tolower(gsub( " .*$", "", barometern_df %>%filter(Indikator!="Konfidensindikator hushåll",Indikator!="Barometerindikatorn",Period==last(Period)) %>%  filter(Barometerindikatorn.och.andra.indikatorer==min(Barometerindikatorn.och.andra.indikatorer)) %>% .$Indikator))` uppfattar den ekonomiska utvecklingen som mer negativ. Tjänstesektorn drabbades värst under pandemin (mars/april 2020), medan tillverkningsindustrin uppfattade ekonomin som starkare än normalt från slutet av 2020 fram till mitten av 2022.

Med undantag för branschgruppen byggindustri, har synen på läget i ekonomin förbättrats den senaste månad för såväl företagen som hushållen.

```{r, include = FALSE}

  barometern_jmf_df<- barometern_df %>%
    filter(Period>"2019-12",Indikator=="Tillverkningsindustri (SNI 10-33)") %>% 
      mutate("Barometerindikatorn.och.andra.indikatorer"=100,
             "Indikator"="Normalt läge i ekonomin")
    
  barometern_bransch_utskrift<-rbind(barometern_df %>% filter(Indikator!="Barometerindikatorn",Period>"2019-12"),barometern_jmf_df)

    
 barometern_bransch_utskrift <-  barometern_bransch_utskrift %>% 
  mutate(Indikator = case_when(barometern_bransch_utskrift$Indikator == "Byggindustri (SNI 41-43)" ~ "Byggindustri",
                                barometern_bransch_utskrift$Indikator == "Detaljhandel (SNI 45 + 47)" ~ "Detaljhandel",
                                barometern_bransch_utskrift$Indikator == "Tillverkningsindustri (SNI 10-33)" ~ "Tillverkningsindustri",
                                barometern_bransch_utskrift$Indikator == "Tjänstesektorn (SNI 49-82 + 95-96)" ~ "Tjänstesektorn",
                                barometern_bransch_utskrift$Indikator == "Konfidensindikator hushåll" ~ "Hushåll",
                                .default = barometern_bransch_utskrift$Indikator))
       
  barometern_bransch_utskrift <- barometern_bransch_utskrift %>% 
  mutate(Indikator = factor(Indikator, levels = c("Byggindustri", "Detaljhandel", "Tillverkningsindustri",
                                                  "Tjänstesektorn", "Hushåll", 
                                                  "Normalt läge i ekonomin")))

  diagramtitel <- paste0("Barometerindikatorns utveckling i Sverige mellan januari 2020 och ",last(barometern_bransch_utskrift$manad_long)," ",last(barometern_bransch_utskrift$ar))
  diagramtitel = str_wrap(diagramtitel,45)

    diagramfilnamn <- paste0("barometern_bransch.png")
    
    konj_bransch <- SkapaLinjeDiagram(skickad_df = barometern_bransch_utskrift ,
                              skickad_x_var = "Period", 
                              skickad_y_var = "Barometerindikatorn.och.andra.indikatorer",
                              skickad_x_grupp ="Indikator",
                              berakna_index=FALSE,
                              manual_color = c(diagramfarger("rus_sex")[1:5],"#000000"),
                              manual_y_axis_title="Indikatorvärde",
                              stodlinjer_avrunda_fem = TRUE,
                              diagram_titel = diagramtitel,
                              diagram_capt =  diagram_capt,
                              output_mapp = output_mapp,
                              x_axis_storlek = 7,
                              #visa_var_x_xlabel=12,
                              filnamn_diagram = diagramfilnamn,
                              skriv_till_diagramfil = spara_figur)
  
```

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=8, fig.align='center'}
konj_bransch
```

## Inflation
Ytterligare en faktor som är viktig för ett lands ekonomi är förändringen i den allmänna prisnivån, så kallad inflation. Normalt förknippas hög inflation med problem, eftersom varor och tjänster blir dyrare. Om inte lönerna ökar i samma takt blir människor fattigare i reala termer, vilket har blivit påtagligt i Sverige det senaste året. Även låg, eller negativ, inflation kan vara skadligt för ekonomin. Exempelvis missgynnas låntagare av en sjunkande prisnivå, då deras lån ökar i värde realt. Sveriges Riksbank strävar därför efter att hålla inflationen relativt konstant över tid, runt ett uttalat inflationsmål. 
<br>

<details>

  <summary>Mer information om statistiken</summary>

<div title="Källa: Riksbanken">Det vanligaste och mest kända sättet att mäta inflationen på i Sverige är titta på förändringen i konsumentprisindex, KPI. Under senare tid har måttet utvecklats med att hålla räntenivån fast, då kallat KPIF. Anledningen är att räntan kan påverka prisnivån indirekt, framförallt genom boendekostnader. Konsumentprisindex med fast ränta, KPIF beräknas med samma data och på samma sätt som KPI, men utan att effekten av ändrade räntor räknas med. Indexet visar hur mycket det kostar att leva i Sverige och hur denna kostnad har utvecklats över tid. Målet för Riksbankens penningpolitik är att inflationen ska vara 2 procent. Ett viktigt skäl till den tydliga målsättningen är också att skapa trygghet och långsiktighet för företag och hushåll i deras ekonomiska beslut. </div>
 
</details>

Sedan Riksbankens inflationsmål infördes 1993 har inflationen, mätt som årsförändring i KPIF, legat klart under inflationsmålet på 2 procent under långa perioder. Från sin bottennivå i april 2020 ökade dock inflationen väldigt mycket och var som högst i `r KPI_df %>%filter(Period>"1993-01") %>% filter(KPIF==max(KPIF,na.rm=TRUE)) %>% select(manad_long,ar)`, då den i Sverige uppgick till `r gsub("\\.",",",KPI_df %>%filter(Period>"1993-01") %>% filter(KPIF==max(KPIF,na.rm=TRUE)) %>% .$KPIF)` procent. Därefter har inflationstakten sjunkit avsevärt och var i `r KPI_df %>% filter(månad==last(månad)) %>% select(manad_long,ar)`, `r gsub("\\.",",",KPI_df %>% filter(månad==last(månad)) %>% .$KPIF)` procent, vilket är mer eller mindre i linje med Riksbankens inflationsmål. Den höga inflationstakten under framförallt 2022 och 2023 har ett antal olika förklaringar, däribland begränsningar i utbudet av varor när världen öppnade upp efter Corona-pandemin och Rysslands invasion av Ukraina. Läs mer på  [Wikipedia](https://en.wikipedia.org/wiki/2021%E2%80%932023_inflation_surge){target="_blank"}.

```{r, include = FALSE}

 diagram_capt <- "Källa: SCBs öppna statistikdatabas.\nBearbetning: Samhällsanalys, Region Dalarna."

  KPI_df<-KPI_df %>%
    mutate("variabel"="Inflation")

  # skapar dataframe vars syfte är att skapa en svart linje i diagrammet

  KPI_df_mal<- KPI_df %>%
    select(KPIF,manad_long,Period,variabel) %>%
      mutate("KPIF"=2,
              "variabel" = "Riksbankens inflationsmål")
  
  KPI_utskrift <- rbind(KPI_df %>% select(KPIF,manad_long,Period,variabel),KPI_df_mal)
    
  # Skapa startvärde. Första värde måste ligga inom marginalen 12 månader från sista värde.
  #startvarde <- paste0("1993","-",substr(last(KPI_utskrift$Period),6,7))
 startvarde <- "1993-01"
  diagramtitel <- paste0("Inflation i Sverige från januari 1993 till ",last(KPI_df$manad_long)," ",last(KPI_df$ar))
  diagramfilnamn <- paste0("inflation.png")

  inflation_linje <- SkapaLinjeDiagram(skickad_df = KPI_utskrift %>% 
                                         filter(Period>=startvarde),
                                          skickad_x_var = "Period",
                                          skickad_y_var = "KPIF",
                                          skickad_x_grupp = "variabel",
                                          berakna_index=FALSE,
                                          stodlinjer_avrunda_fem = FALSE,
                                          manual_color = c(diagramfarger("rus_sex")[1],"#000000"),
                                          diagram_titel = diagramtitel,
                                          diagram_capt =  diagram_capt,
                                          output_mapp = output_mapp,
                                          manual_y_axis_title = "procent",
                                          visa_var_x_xlabel=24,
                                          filnamn_diagram = diagramfilnamn,
                                          skriv_till_diagramfil = spara_figur)
  
```

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=8, fig.align='center'}
inflation_linje
```

# Bostadsmarknaden
2010-talet kännetecknades av en bostadsmarknad där det mesta pekade uppåt. Låg inflation och låga räntor i kombination med fördelaktiga skatteregler medförde att såväl byggandet av bostäder, som bostadspriserna ökade kraftigt. Även bostadslånen har ökat under en lång period och uppgick 2022 till ca 170 procent av hushållens disponibla inkomst, vilket är ungefär dubbelt så stor andel som under mitten av 1990-talet. Samtidigt har hushållens finansiella tillgångar ökat, vilket medfört att skulderna i relation till de finansiella tillgångarna minskat något under samma tidsperiod [(SCB)](https://www.scb.se/hitta-statistik/statistik-efter-amne/finansmarknad/finansrakenskaper/finansrakenskaper-kvartal-och-ar/pong/tabell-och-diagram/arstabeller/hushallens-laneskulder-i-procent-av-justerad-disponibel-inkomst-och-av-hushallens-finansiella-tillgangar/){target="_blank"}. 

## Bostadsbyggande{.tabset}

<details>

  <summary>Mer information om statistiken</summary>

<div title="Källa: SCB">Statistiken omfattar alla nybyggnadsprojekt som kräver bygglov. Bygglovsstatistik för bostäder visar antal bygglov och lägenheter. Nybyggnad av bostäder visar bostadsbyggandets omfattning och inriktning av bostadslägenheter. Data i figurerna nedan visar bygglov och nybyggnad av bostäder på kvartalsbasis.</div>
 
</details>

### Bygglov {-}
Antalet godkända bygglov för småhus varierar mellan kvartalen, men en tydlig trend är att de har börjat minska på senare tid. Sedan toppen i  `r Bygglov_df %>%filter(ar>"2019",hustyp=="småhus") %>% filter(Antal==max(Antal)) %>% select(kvartal,ar) %>% .[1,]`, då `r Bygglov_df %>%filter(ar>"2019",hustyp=="småhus") %>% filter(Antal==max(Antal)) %>% .$Antal %>% .[1]` bygglov godkändes, har antalet godkända bygglov minskat och i `r Bygglov_df %>%filter(hustyp=="småhus") %>% filter(Antal==last(Antal)) %>% select(kvartal,ar)`, godkändes `r Bygglov_df %>%filter(,hustyp=="småhus") %>% filter(Antal==last(Antal)) %>% .$Antal` bygglov. För flerbostadshus är trenden relativt likvärdig, men variationen är större från kvartal till kvartal. Under `r Bygglov_df %>%filter(ar>"2009",hustyp=="småhus") %>% filter(Antal==last(Antal)) %>% select(kvartal,ar)`, godkändes bygglov för blott `r Bygglov_df %>%filter(ar>"2009",hustyp=="flerbostadshus exkl. specialbostäder") %>% filter(Antal==last(Antal)) %>% .$Antal` bostadslägenheter i Dalarna.

```{r, include = FALSE}

  diagram_capt <- "Källa: SCBs öppna statistikdatabas.\nBearbetning: Samhällsanalys, Region Dalarna."

  diagramtitel <- paste0("Antal godkända bygglov i Dalarna")
  diagramfilnamn <- paste0("bygglov.png")

  bygglov_linje <- SkapaLinjeDiagram(skickad_df = Bygglov_df %>%
                                              filter(ar>"2019") %>%
                                                filter(hustyp%in%c("småhus","flerbostadshus exkl. specialbostäder")), 
                                          skickad_x_var = "ar_kvartal",
                                          skickad_y_var = "Antal",
                                          skickad_x_grupp = "hustyp",
                                          berakna_index=FALSE,
                                          manual_color = c(diagramfarger("rus_sex")),
                                          stodlinjer_avrunda_fem = TRUE,
                                          diagram_titel = diagramtitel,
                                          diagram_capt =  diagram_capt,
                                          output_mapp = output_mapp,
                                          manual_y_axis_title = "Antal",
                                          visa_var_x_xlabel=1,
                                          filnamn_diagram = diagramfilnamn,
                                          skriv_till_diagramfil = spara_figur)

```

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=8, fig.align='center'}
bygglov_linje
```

### Nybyggnation {-}
Precis som byggloven, varierar byggandet av småhus mellan kvartalen, men en tydlig trend är att byggandet har börjat minska på senare tid. Sedan toppen i  `r Husbyggande_df %>%filter(ar>"2019",hustyp=="småhus") %>% filter(Paborjade==max(Paborjade)) %>% select(kvartal,ar) %>% .[1,]`, då `r Husbyggande_df %>%filter(ar>"2019",hustyp=="småhus") %>% filter(Paborjade==max(Paborjade)) %>% .$Paborjade %>% .[1]` småhus påbörjades, har antalet minskat och i `r Husbyggande_df %>%filter(hustyp=="småhus") %>% filter(ar_kvartal==last(ar_kvartal)) %>% select(kvartal,ar)`, påbörjades `r Husbyggande_df %>%filter(hustyp=="småhus") %>% filter(ar_kvartal==last(ar_kvartal)) %>% .$Paborjade` småhus. För flerbostadshus är trenden relativt likvärdig, men variationen är större från kvartal till kvartal. Under `r Husbyggande_df %>%filter(hustyp=="flerbostadshus") %>% filter(ar_kvartal==last(ar_kvartal)) %>% select(kvartal,ar)`, påbörjades byggande av `r Husbyggande_df %>%filter(hustyp=="flerbostadshus") %>% filter(ar_kvartal==last(ar_kvartal)) %>% .$Paborjade` lägenheter i Dalarna.

```{r, include = FALSE}

  diagram_capt <- "Källa: SCBs öppna statistikdatabas.\nBearbetning: Samhällsanalys, Region Dalarna."

  diagramtitel <- paste0("Nybyggnad av bostäder i Dalarna")
  diagramfilnamn <- paste0("nybyggnation.png")

  Nybyggnation_linje <- SkapaLinjeDiagram(skickad_df = Husbyggande_df %>%
                                              filter(ar>"2019"),
                                          skickad_x_var = "ar_kvartal",
                                          skickad_y_var = "Paborjade",
                                          skickad_x_grupp = "hustyp",
                                          berakna_index=FALSE,
                                          stodlinjer_avrunda_fem = TRUE,
                                          manual_color = c(diagramfarger("rus_sex")),
                                          diagram_titel = diagramtitel,
                                          diagram_capt =  diagram_capt,
                                          output_mapp = output_mapp,
                                          manual_y_axis_title = "Antal",
                                          visa_var_x_xlabel=1,
                                          filnamn_diagram = diagramfilnamn,
                                          skriv_till_diagramfil = spara_figur)
  
```

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=8, fig.align='center'}
Nybyggnation_linje
```

## Bostadspriser{.tabset}

<details>

  <summary>Mer information om statistiken</summary>

<div title="Källa: SCB">Noteringen om månad avser i själva verket en tremånadersperiod, där noteringen avser den sista månaden i perioden.</div> 
 
</details>

### Historisk jämförelse {-}

Priserna på småhus ökade stadigt under en lång period, såväl i Dalarna som i Sverige. Efter toppen i `r priser_df %>% filter(Medelpris==(max(priser_df %>% filter(ar>2009,region%in%c("Dalarna")) %>% select(Medelpris)))) %>% select(manad_long,ar)`, då ett småhus i Dalarna kostade ungefär `r round(priser_df %>% filter(Medelpris==(max(priser_df %>% filter(ar>2009,region%in%c("Dalarna")) %>% select(Medelpris)))) %>% .$Medelpris/1000,1)` miljoner kronor, har dock det genomsnittliga priset på småhus i länet minskat avsevärt till `r gsub("\\.",",",(round(priser_df %>% filter(Period==last(Period),region=="Dalarna") %>% select(Medelpris)/1000,1)))` miljoner kronor i `r priser_df %>% filter(Period==last(Period),region=="Dalarna") %>% select(manad_long,ar)`. Minskningen kan delvis förklaras av Rysslands invasion av Ukraina, vilken bland annat medfört en kraftigt ökad inflation med efterföljande räntehöjningar, något som påverkar efterfrågan på bostäder. 

```{r, include = FALSE}
# Skapar ett linjediagram för förändring i priser. Blir något fel när man skapar index via funktionen, 
  # så jag gör det på egen hand
  diagram_capt <- "Källa: SCB:s öppna statistikdatabas.\nBearbetning: Samhällsanalys, Region Dalarna."

  region_vekt="20"
  jmf_vekt="00"
  ValdGeografi <- skapa_kortnamn_lan(hamtaregion_kod_namn(region_vekt)$region,byt_ut_riket_mot_sverige = TRUE)
  jmf_geografi <- skapa_kortnamn_lan(hamtaregion_kod_namn(jmf_vekt)$region,byt_ut_riket_mot_sverige = TRUE) 
  
    # Skapa startvärde. Första värde måste ligga inom marginalen 12 månader från sista värde.
  #startvarde <- paste0("2010","-",substr(last(KPI_utskrift$Period),6,7))
  
  diagramtitel <- paste0("Förändring i priser på småhus mellan januari 2010 och ",last(priser_df$manad_long)," ",last(priser_df$ar))
  diagramtitel = str_wrap(diagramtitel,40)
  diagramfilnamn <- paste0("smahuspriser_tidserie.png")
  
  smahuspriser_linje <- SkapaLinjeDiagram(skickad_df = priser_df %>% 
                                          filter(ar > 2009,region%in%c(jmf_geografi,ValdGeografi))%>%
                                            group_by(region)%>% 
                                                mutate("Index (startvärde 100)"=(Medelpris/first(Medelpris))*100),
                                         skickad_x_var = "Period", 
                                         skickad_y_var = "Index (startvärde 100)", 
                                         skickad_x_grupp = "region",
                                         berakna_index=FALSE,
                                         stodlinjer_avrunda_fem = TRUE,
                                         manual_color = diagramfarger("rus_sex"),
                                         diagram_titel = diagramtitel,
                                         diagram_capt =  diagram_capt,
                                         output_mapp = output_mapp,
                                         visa_var_x_xlabel=24,
                                         filnamn_diagram = diagramfilnamn,
                                         skriv_till_diagramfil = spara_figur)
  
  
```

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=8, fig.align='center'}
smahuspriser_linje

```

### Län {-}
Det genomsnittliga priset på ett småhus varierar mellan Sveriges län och var i `r priser_df %>%filter(Period==max(Period),region=="Sverige") %>% select(manad_long,ar)`, högst i `r priser_df %>%filter(Period==max(Period)) %>% filter(Medelpris==max(Medelpris)) %>% .$region`, där ett småhus i genomsnitt kostade `r gsub("\\.",",", round(priser_df %>%filter(Period==max(Period)) %>% filter(Medelpris==max(Medelpris)) %>% select(Medelpris)/1000,1))` miljoner kronor. I Dalarna är priset klart lägre, ett småhus kostade i genomsnitt `r gsub("\\.",",", round(priser_df %>%filter(Period==max(Period)) %>% filter(region=="Dalarna") %>% select(Medelpris)/1000,1))` miljoner kronor i länet.

```{r, include = FALSE}
# Skapar ett linjediagram för förändring i priser. Blir något fel när man skapar index via funktionen, 
  # så jag gör det på egen hand
  diagram_capt <- "Källa: SCB:s öppna statistikdatabas.\nBearbetning: Samhällsanalys, Region Dalarna."

  region_vekt="20"
  jmf_vekt="00"
  
  ValdGeografi <- skapa_kortnamn_lan(hamtaregion_kod_namn(region_vekt)$region,byt_ut_riket_mot_sverige = TRUE)
  jmf_geografi <- skapa_kortnamn_lan(hamtaregion_kod_namn(jmf_vekt)$region,byt_ut_riket_mot_sverige = TRUE) 
  
  diagramtitel <- paste0("Småhuspriser i ",last(priser_df$manad_long)," ",max(priser_df$ar))
  diagramfilnamn <- paste0("smahuspriser_lan.png")
  
  smahuspriser_län <- SkapaStapelDiagram(skickad_df = priser_df %>%
                                           filter(Period == last(Period)) %>% 
                                             mutate(fokus=ifelse(region == ValdGeografi,1,
                                                                 ifelse(region == jmf_geografi,2,0))),
                                       skickad_x_var = "region", 
                                       skickad_y_var = "Medelpris",
                                       x_var_fokus = "fokus",
                                       manual_x_axis_text_vjust=1,
                                       manual_x_axis_text_hjust=1,
                                       stodlinjer_avrunda_fem = TRUE,
                                       manual_color = diagramfarger("rus_tre_fokus")[1:3],
                                       diagram_titel = diagramtitel,
                                       manual_y_axis_title = "Medelpris (tkr)",
                                       x_axis_sort_value = TRUE,
                                       diagram_capt =  diagram_capt,
                                       diagram_facet = FALSE,
                                       output_mapp = output_mapp,
                                       filnamn_diagram = diagramfilnamn,
                                       skriv_till_diagramfil = spara_figur)
  
  
```

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=8, fig.align='center'}
smahuspriser_län

```

# Företagandet
```{r, include = FALSE}
k=1
```
Läget för företagen i länet hänger naturligtvis samman med läget i ekonomin i stort. En indikator på sämre tider är att företag tvingas gå i konkurs, och en annan potentiell indikator är att färre nya företag startas.

## Konkurser {.tabset}
```{r, include = FALSE}
k = k+1
```

### Konkurser per månad {-}

```{r, include = FALSE}
# Skapar ett linjediagram för förändring i priser. Blir något fel när man skapar index via funktionen, 
  # så jag gör det på egen hand
  diagram_capt = "Källa: Näringsverksamhet, Konkurser och ackord, SCB:s öppna statistikdatabas\nBearbetning: Samhällsanalys, Region Dalarna"

  senaste_ar <- max(konkurser_df$år)
  senaste_manad <- last(konkurser_df$manad_long)
  senaste_ar_num <- senaste_ar %>% as.numeric()
  
    # gruppera per månad för senaste året och för året innan det
  konkurser_jmfr <- konkurser_df %>% 
    filter(år %in% c(senaste_ar, as.character(as.numeric(senaste_ar) -1))) %>% 
    group_by(år, månad,manad_long, regionkod, region) %>%
    summarize(Antal_berorda = sum(Antal_berorda)) %>% 
    ungroup()
  
  # konkurser_fem_senaste2 <- konkurser_df %>% 
  #   filter(år %in% as.character(c(senaste_ar_num:(senaste_ar_num -4)))) %>% 
  #   group_by(månad, regionkod, region) %>% summarise(tot = sum(Konkurser, na.rm = TRUE))
  
  jmfr_varnamn <- paste0("genomsnitt år ", as.character((senaste_ar_num-6)), "-", as.character((as.numeric(senaste_ar)-2)))
  
  antal_ar <- length(as.character(c(senaste_ar_num-2):(senaste_ar_num -6)))
  # gruppera fem senaste år
  konkurser_fem_senaste <- konkurser_df %>% 
    filter(år %in% as.character(c((senaste_ar_num-2):(senaste_ar_num -6)))) %>% 
    group_by(månad,manad_long, regionkod, region) %>%
    summarize(Berorda_tot = sum(Antal_berorda, na.rm = TRUE),
              Antal_berorda = Berorda_tot/antal_ar) %>% 
    ungroup() %>% 
    mutate(år = jmfr_varnamn)
  
  konkurser_jmfr <- konkurser_jmfr %>% 
    bind_rows(konkurser_fem_senaste) %>% 
    mutate(år = factor(år, levels = c(jmfr_varnamn, as.character(senaste_ar_num-1), senaste_ar)))
  
  # skapa månader med NA-värde för de månader som vi saknar värde för, så att
  # staplarna inte blir tjocka utan att vi får ett tomrum där istället
  konkurser_jmfr <- konkurser_jmfr %>%
    group_by(år, regionkod, region) %>%
    complete(månad)
   
  konkurser_jmfr <- konkurser_jmfr %>%
    mutate(manad_long = str_to_title(manad_long)) %>% 
      mutate(manad_long = factor(manad_long, levels = c("Januari", "Februari", "Mars", "April", "Maj", 
                                                        "Juni", "Juli", "Augusti", "September", "Oktober",
                                                        "November", "December")))
  
  # Ser till att vi fyller på 2023 med de månader som saknas (för att undvika tjocka staplar) - lite oklart varför koden ovan inte gör det?
  # konkurser_jmfr <- konkurser_jmfr %>% 
  #   complete(månad)
    
  diagram_titel <- str_wrap("Antal personer berörda av konkurser i Dalarnas län")

  diagramfilnamn <- paste0("konkurser_lan.png")
  
  # konkurser_lan <- SkapaStapelDiagram(skickad_df = konkurser_jmfr %>% 
  #                                      filter(år != "2021"), 
  #                                    skickad_x_var = "månad", 
  #                                    skickad_y_var = "Antal_berorda",
  #                                    skickad_x_grupp = "år",
  #                                    diagram_titel = diagram_titel,
  #                                    diagram_capt = diagram_capt,
  #                                    manual_x_axis_text_vjust = 1,
  #                                    manual_x_axis_text_hjust = 1,
  #                                    stodlinjer_avrunda_fem = TRUE,
  #                                    #diagram_facet = jmfr_riket,
  #                                    manual_y_axis_title = "Antal berörda personer",
  #                                    facet_grp = "region",
  #                                    facet_legend_bottom = TRUE,
  #                                    manual_color = diagramfarger("bla_gra_tre")[c(2,1,3)],
  #                                    output_mapp = output_mapp,
  #                                    filnamn_diagram = diagramfilnamn,
  #                                    skriv_till_diagramfil = spara_figur)
  
    konkurser_lan <- SkapaLinjeDiagram(skickad_df = konkurser_jmfr ,
                                         skickad_x_var = "manad_long", 
                                         skickad_y_var = "Antal_berorda", 
                                         skickad_x_grupp = "år",
                                         berakna_index = FALSE,
                                         manual_color = diagramfarger("rus_sex"),
                                         lagga_till_punkter = TRUE,
                                         diagram_titel = diagram_titel,
                                         diagram_capt =  diagram_capt,
                                         output_mapp = output_mapp,
                                         stodlinjer_avrunda_fem = TRUE,
                                         manual_y_axis_title = "Antal",
                                         visa_var_x_xlabel=1,
                                         filnamn_diagram = diagramfilnamn,
                                         skriv_till_diagramfil = spara_figur)
    
    # add geom_point to avregistrerade_linje with same colors
# konkurser_lan <- konkurser_lan + geom_point(data = konkurser_jmfr,
#                                           aes(x = manad_long,y = Antal_berorda,group=år,color=år), size=2.5)
# 
# if(spara_figur){
#   ggsave(paste0(output_mapp,diagramfilnamn), plot = konkurser_lan, width = 12, height = 7)
# }

  
```

Antalet personer som berörs av konkurser varierar relativt mycket från månad till månad vilket medför att det är svårt att se någon trend på månadsbasis kopplad till exempelvis Rysslands invasion av Ukraina. I `r senaste_manad` `r senaste_ar` berördes `r konkurser_jmfr %>% filter(år==senaste_ar,manad_long==str_to_title(senaste_manad)) %>% .$Antal_berorda` personer av konkurser i Dalarna, att jämföra med `r konkurser_jmfr %>% filter(år==as.character(senaste_ar_num-1),manad_long==str_to_title(senaste_manad)) %>% .$Antal_berorda` motsvarande månad `r as.character(senaste_ar_num-1)`. Värt att notera är även att `r konkurser_df %>% filter(år==last(år)) %>% group_by(region,år) %>% .$Antal_berorda %>% sum()` personer har berörts av konkurser i Dalarna hittills i år, vilket är klart fler än de `r konkurser_df  %>% filter(år==(as.numeric(last(år))-1),månad%in%unique(konkurser_df  %>% filter(år==last(år)) %>% .$månad)) %>% group_by(region,år) %>% .$Antal_berorda %>% sum()` som berördes under motsvarande period föregående år.

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=8, fig.align='center'}
konkurser_lan
```

### Konkurser per bransch {-}

```{r, include = FALSE}
# Skapar ett linjediagram för förändring i priser. Blir något fel när man skapar index via funktionen,
  # så jag gör det på egen hand
  diagram_capt = "Källa: Näringsverksamhet, Konkurser och ackord, SCB:s öppna statistikdatabas\nBearbetning: Samhällsanalys, Region Dalarna"

  senaste_ar <- last(unique(konkurser_df$månad_år))
  # ett_ar_sedan <- nth(unique(konkurser_df$månad_år),length(unique(konkurser_df$månad_år))-12)

  # Väljer ut de branscher som har fler än noll antal påverkade av konkurs. Mutate ändrar till stor bokstav.
  konkurser_bransch_10 <- konkurser_df %>%
    rename("bransch"= näringslivet) %>%
      filter(månad_år%in%senaste_ar) %>%
        slice_max(Antal_berorda,n=10) %>%
          filter(Antal_berorda>0) %>% 
            mutate(bransch = paste0(toupper(substr(bransch, 1, 1)), substr(bransch, 2, nchar(bransch))))

  konkurser_bransch_10$bransch <- str_wrap(konkurser_bransch_10$bransch,40)

  diagram_titel <- paste0("Antal personer berörda av konkurser i ",unique(konkurser_bransch_10$region)," ",unique(konkurser_bransch_10$månad_år))
  diagramfilnamn <- paste0("konkurser_bransch.png")

  konkurser_bransch <- SkapaStapelDiagram(skickad_df = konkurser_bransch_10 ,
                                     skickad_x_var = "bransch",
                                     skickad_y_var = "Antal_berorda",
                                     diagram_titel = diagram_titel,
                                     diagram_capt = diagram_capt,
                                     manual_x_axis_text_vjust = 1,
                                     manual_x_axis_text_hjust = 1,
                                     #diagram_facet = jmfr_riket,
                                     manual_y_axis_title = "Antal berörda av konkurser",
                                     facet_grp = "region",
                                     facet_legend_bottom = TRUE,
                                     manual_color = diagramfarger("rus_sex")[1],
                                     stodlinjer_avrunda_fem = TRUE,
                                     x_axis_lutning = 0,
                                     output_mapp = output_mapp,
                                     x_axis_sort_value = TRUE,
                                     diagram_liggande = TRUE,
                                     filnamn_diagram = diagramfilnamn,
                                     skriv_till_diagramfil = spara_figur)

  
```
Den bransch som drabbades värst av konkurser i `r senaste_manad` `r unique(konkurser_bransch_10$år)` var "`r konkurser_bransch_10 %>% filter(Antal_berorda==max(Antal_berorda)) %>% .$bransch`", där `r konkurser_bransch_10 %>% filter(Antal_berorda==max(Antal_berorda)) %>% .$Antal_berorda` personer berördes av konkurser.

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=8, fig.align='center'}
konkurser_bransch
```

## Avregistrerade företag

```{r, echo = FALSE, message = FALSE, warning = FALSE, include = FALSE}
  
# Ger månaderna namn  
  antal_avregistreringar_df <- antal_avregistreringar_df %>% 
      mutate(manad_long = case_when(
        Månad == "01" ~ "Januari",
         Månad == "02" ~ "Februari",
         Månad == "03" ~ "Mars",
         Månad == "04" ~ "April",
         Månad == "05" ~ "Maj",
         Månad == "06" ~ "Juni",
         Månad == "07" ~ "Juli",
         Månad == "08" ~ "Augusti",
         Månad == "09" ~ "September",
         Månad == "10" ~ "Oktober",
         Månad == "11" ~ "November",
         Månad == "12" ~ "December",
      ))
```

Ett potentiellt alternativ till att begära ett företag i konkurs är att istället avregistrera det. Antalet avregistrerade företag tenderar att följa ett tydligt säsongsmönster, där klart flest företag avregistreras i januari. Det är dock svårt att se någon långsiktig trend, då ungefär lika många företag avregistreras varje år. De senaste månaderna har dock något färre företag avregistreras jämfört med samma period tidigare år. I `r tolower(last(antal_avregistreringar_df$manad_long))` `r max(antal_avregistreringar_df$År)` avregistrerades `r last(antal_avregistreringar_df$antal)` företag i Dalarna, jämfört med `r last(antal_avregistreringar_df %>% filter(Månad == last(antal_avregistreringar_df %>% filter(År == max(.$År)) %>% .$Månad)) %>% filter(År == (max(.$År)-1)) %>% .$antal)` samma månad året innan.

```{r, include = FALSE}
    diagram_capt <- "Källa: Bolagsverket.\nBearbetning: Samhällsanalys, Region Dalarna."

    diagramtitel <- paste0("Antal avregistrerade företag i Dalarna")
    diagramfilnamn <- paste0("avreg_manad.png")
    
    antal_avregistreringar_df$manad_long = factor(antal_avregistreringar_df$manad_long,levels=c("Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"))
      
avregistrerade_linje <- SkapaLinjeDiagram(skickad_df = antal_avregistreringar_df %>%
                                             mutate(År = as.character(År)),
                                           skickad_x_var = "manad_long",
                                           skickad_y_var = "antal",
                                           skickad_x_grupp = "År",
                                           berakna_index = FALSE,
                                           lagga_till_punkter = TRUE,
                                           manual_color = diagramfarger("rus_sex"),
                                           diagram_titel = diagramtitel,
                                           diagram_capt =  diagram_capt,
                                           output_mapp = output_mapp,
                                           stodlinjer_avrunda_fem = TRUE,
                                           manual_y_axis_title = "Antal",
                                           #visa_var_x_xlabel=1,
                                           filnamn_diagram = diagramfilnamn,
                                           skriv_till_diagramfil = spara_figur)

# add geom_point to avregistrerade_linje with same colors
# avregistrerade_linje <- avregistrerade_linje + geom_point(data = antal_avregistreringar_df %>%
#                                             mutate(År = as.character(År)),
#                                           aes(x = manad_long,y = antal,group=År,color=År), size=2.5)
# 
# if(spara_figur){
#   ggsave(paste0(output_mapp,diagramfilnamn), plot = avregistrerade_linje, width = 12, height = 7)
# }
    

# avregistrerade_stapel <- SkapaStapelDiagram(skickad_df = antal_avregistreringar_df %>% 
#                                              mutate(År = as.character(År)),
#                                            skickad_x_var = "manad_long", 
#                                            skickad_y_var = "antal", 
#                                            skickad_x_grupp = "År",
#                                            berakna_index = FALSE,
#                                            manual_color = diagramfarger("rus_sex"),
#                                            diagram_titel = diagramtitel,
#                                            manual_x_axis_text_vjust = 1,
#                                            manual_x_axis_text_hjust = 1,
#                                            diagram_capt =  diagram_capt,
#                                            output_mapp = output_mapp,
#                                            stodlinjer_avrunda_fem = TRUE,
#                                            manual_y_axis_title = "Antal",
#                                            #visa_var_x_xlabel=1,
#                                            filnamn_diagram = diagramfilnamn,
#                                            skriv_till_diagramfil = spara_figur)
  
  
```

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=8, fig.align='center'}
avregistrerade_linje
```

## Nystartade företag

<details>

  <summary>Mer information om statistiken</summary>

<div title="Källa: Tillväxtanalys">Statistiken beskriver mängden genuint nystartade företag. Med genuint nystartade företag menas företag som är helt nybildade eller har återupptagits efter att ha varit vilande i minst två år. Företag som nyregisteras på grund av ägarskiften, ändring av juridisk form eller annan ombildning exkluderas. Från och med 2011 är statistiken registerbaserad. </div> 
 
</details>

```{r, include = FALSE}
    diagram_capt <- "Källa: Tillväxtanalys.\nBearbetning: Samhällsanalys, Region Dalarna."
    
    # Diverse justeringar
    nystartade_df <- nystartade_df %>% 
      rename(ar_kvartal = X1,
         lan_nr = X2,
         antal =`antal.nystartade.företag`) %>% 
        mutate(ar = substr(ar_kvartal,1,4),
               kvartal = substr(ar_kvartal,5,6)) %>% 
          mutate(kvartal_namn = case_when(
            kvartal == "Q1" ~ "kvartal ett",
            kvartal == "Q2" ~ "kvartal två",
            kvartal == "Q3" ~ "kvartal tre",
            kvartal == "Q4" ~ "kvartal fyra")) %>% 
            mutate(grupp = "Nystartade företag")
    
    # Beräknar medel över perioden (för att stoppa in i diagram)
    # nystartade_df_medel <- nystartade_df %>%
    #   mutate(antal = mean(antal),
    #          grupp = "Genomsnitt sedan 2011")
    
    #ystartade_utskrift <- rbind(nystartade_df_medel,nystartade_df)

    diagramtitel <- paste0("Antal nystartade företag per kvartal i Dalarna")
    diagramfilnamn <- paste0("nystartade.png")
    
    nystartade_linje <- SkapaLinjeDiagram(skickad_df = nystartade_df,
                                       skickad_x_var = "ar_kvartal",
                                       skickad_y_var = "antal",
                                       skickad_x_grupp = "grupp",
                                       berakna_index = FALSE,
                                       stodlinjer_avrunda_fem = TRUE,
                                       manual_color = c(diagramfarger("rus_sex")[1],"#000000"),
                                       diagram_titel = diagramtitel,
                                       diagram_capt =  diagram_capt,
                                       output_mapp = output_mapp,
                                       manual_y_axis_title = "Antal nystartade företag",
                                       legend_tabort = TRUE,
                                       visa_var_x_xlabel= 4,
                                       filnamn_diagram = diagramfilnamn,
                                       skriv_till_diagramfil = spara_figur)
```


En annan indikator på läget för företagen i länet är hur många nya företag som startas. Historiskt startades väldigt många företag i samband med Corona-pandemin 2020-2021. I  `r nystartade_df %>% filter(antal == max(antal)) %>% .$kvartal_namn` `r nystartade_df %>% filter(antal == max(antal)) %>% .$ar` startades exempelvis `r nystartade_df %>% filter(antal == max(antal)) %>% .$antal` företag, vilket är det största antalet sedan åtminstone 2011. Exakt vad detta beror på kan vara svårt att säga, men en potentiell förklaring är att individer som blev uppsagda under pandemin valde att starta egna företag. Någon större trend sedan Rysslands invasion av Ukraina märktes inte initialt för antalet nystartade företag. Under 2022 startades till och med något fler företag än genomsnittet sedan 2011. Under första halvan av 2023 märktes en viss avmattning dock, men i `r nystartade_df %>% filter(ar_kvartal == first(ar_kvartal)) %>% .$kvartal_namn` `r nystartade_df %>% filter(ar_kvartal == first(ar_kvartal)) %>% .$ar` startades `r nystartade_df %>% filter(ar_kvartal == first(ar_kvartal)) %>% .$antal` företag, vilket är `r nystartade_df %>% filter(ar_kvartal == first(ar_kvartal)) %>% .$antal - first(nystartade_df %>% filter(ar_kvartal != first(ar_kvartal)) %>% .$antal)` fler än föregående kvartal.

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=8, fig.align='center'}
nystartade_linje
```

# Arbetsmarknaden
Som mått på läget i Dalarna, är arbetslösheten sannolikt en relativt trögrörlig indikator. Detta eftersom företag i första läget varslar personal, för att därefter eventuellt göra större uppsägningar. De är även viktigt att notera att arbetslösheten varierar mellan olika grupper i samhället, exempelvis baserat på personers kön, utbildningsbakgrund eller huruvida de är födda i Sverige. För en fördjupad diskussion runt detta, se exempelvis Region Dalarnas rapport ["Kvinnor och män i Dalarna"](https://region-dalarna.github.io/kvinnor_man_i_Dalarna/){target="_blank"}.
 
## Arbetslöshet {.tabset}

<details>

  <summary>Mer information om statistiken</summary>
  
Arbetslöshet beräknas som andelen arbetslösa i förhållande till antalet personer i arbetskraften, det vill säga summan av antalet arbetslösa och antalet sysselsatta. Statistik över arbetslöshet och sysselsättning kan tas fram på olika sätt. Det gör att siffror som rör samma referensperiod kan skilja sig åt beroende på vilken statistikkälla som använts. I den här rapporten används BAS - befolkningens arbetsmarknadsstatus - som redovisar registerbaserad statistik över utbudet av arbetskraft i Sverige.


</details>

### Län {-}
I `r last(arbetsmarknadsstatus_tidsserie %>% filter(region=="Dalarna") %>% .$manad_long)` `r unique(last(arbetsmarknadsstatus_tidsserie %>% filter(region=="Dalarna") %>% .$ar))` hade Dalarna `r gsub("\\.",",",last(arbetsmarknadsstatus_tidsserie %>% filter(region=="Dalarna") %>% .$arbetslöshet))` procents arbetslöshet, att jämföra med `r gsub("\\.",",",last(arbetsmarknadsstatus_tidsserie %>% filter(region=="Riket") %>% .$arbetslöshet))` procent i Sverige som helhet. Noterbart är även att Dalarna har klart lägre arbetslöshet än näraliggande Gävleborg, där arbetslösheten var `r gsub("\\.",",",last(arbetsmarknadsstatus_tidsserie %>% filter(region=="Gävleborg") %>% .$arbetslöshet))` procent under samma tidsperiod. Lägst arbetslös i Sverige hade `r arbetsmarknadsstatus_tidsserie %>% filter(manad_long == last(manad_long),ar == last(ar)) %>% filter(arbetslöshet==min(arbetslöshet)) %>%  .$region`, med `r (gsub("\\.",",",arbetsmarknadsstatus_tidsserie %>% filter(manad_long == last(manad_long),ar == last(ar)) %>% filter(arbetslöshet==min(arbetslöshet)) %>%  .$arbetslöshet))` procent.

```{r, include = FALSE}

  diagramtitel <- paste0("Arbetslöshet i åldersgruppen 20-64 år i ",unique(arbetsmarknadsstatus_tidsserie %>% filter(ar == max(ar)) %>% filter(manad_long==last(manad_long)) %>%  .$manad_long)," ",unique(arbetsmarknadsstatus_tidsserie %>% filter(ar == max(ar)) %>% filter(manad_long==max(manad_long)) %>%  .$ar))
  diagramfilnamn <- paste0("Arbetslöshet","_lan",".png")
  diagram_capt = "Källa: SCB:s öppna statistikdatabas, Befolkningens arbetsmarknadsstatus (BAS)\nBearbetning: Samhällsanalys, Region Dalarna" 

 arbetsloshet_lan <- SkapaStapelDiagram(skickad_df = arbetsmarknadsstatus_tidsserie %>% 
                                           filter(ar == max(ar)) %>%
                                            filter(manad_long==last(manad_long)) %>% 
                                              mutate(region = ifelse(region=="Riket","Sverige",region)) %>% 
                                                mutate("fokus" = ifelse(region=="Dalarna",1,ifelse(region=="Sverige",2,0))),  
                                         skickad_x_var = "region", 
                                         skickad_y_var = "arbetslöshet",
                                         diagram_titel = diagramtitel,
                                         diagram_capt = diagram_capt,
                                         stodlinjer_avrunda_fem = TRUE,
                                         manual_y_axis_title = "procent",
                                         manual_x_axis_text_vjust = 1,
                                         manual_x_axis_text_hjust = 0.9,
                                         x_var_fokus = "fokus",
                                         manual_color = diagramfarger("rus_tre_fokus"),
                                         dataetiketter = FALSE,
                                         x_axis_sort_value = TRUE,
                                         skriv_till_diagramfil = spara_figur,
                                         output_mapp = output_mapp,
                                         filnamn_diagram = diagramfilnamn)

  
```

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=8, fig.align='center'}
arbetsloshet_lan
```

### Jämförelse över tid {-}
Arbetslösheten, såväl i Dalarna som Sverige, varierar över tid. I samband med pandemin orsakad av Covid-19, ökade arbetslösheten och var som högst i Dalarna i `r arbetsmarknadsstatus_tidsserie %>% filter(region=="Dalarna") %>% filter(arbetslöshet==max(arbetslöshet)) %>%  .$manad_long %>% .[1]`  `r arbetsmarknadsstatus_tidsserie %>% filter(region=="Dalarna") %>% filter(arbetslöshet==max(arbetslöshet)) %>%  .$ar %>% .[1]`, då den uppgick till `r  gsub("\\.",",", arbetsmarknadsstatus_tidsserie %>% filter(region=="Dalarna") %>% filter(arbetslöshet==max(arbetslöshet)) %>%  .$arbetslöshet %>% .[1])` procent. Därefter har arbetslösheten minskat och var i `r last(arbetsmarknadsstatus_tidsserie %>% filter(region=="Dalarna") %>% .$manad_long)` `r unique(last(arbetsmarknadsstatus_tidsserie %>% filter(region=="Dalarna") %>% .$ar))` `r gsub("\\.",",",last(arbetsmarknadsstatus_tidsserie %>% filter(region=="Dalarna") %>% .$arbetslöshet))` procent i Dalarna. 

Det finns vissa indikationer på att arbetslösheten har börjat stiga svagt igen, efter att ha minskat stadigt under en lång period.  Arbetslösheten tenderar dock att följa ett visst säsongsmönster, vilket gör det svårt att bedöma om den högre arbetslösheten de senaste månaderna (jämfört med månaderna innan) är en del av en längre trend, eller en följd av säsongsvariationer. Tydligt är i alla fall att långsiktiga trenden sedan mitten av 2021, med stadigt minskande arbetslöshet, har brutits. Arbetslösheten i Dalarna var i december 2023 på ungefär samma nivå som i december föregående år. 

```{r, include = FALSE}
 
  diagram_capt = "Källa: SCB:s öppna statistikdatabas, Befolkningens arbetsmarknadsstatus (BAS)\nBearbetning: Samhällsanalys, Region Dalarna" 

  diagram_titel <- paste0("Arbetslöshet i åldersgruppen 20-64 år")
  diagramfilnamn <- paste0("arbetslöshet_tidsserie.png")
    
  arbetslöshet_linje <- SkapaLinjeDiagram(skickad_df = arbetsmarknadsstatus_tidsserie %>%
                                            filter(region%in%c("Dalarna","Riket")) %>%
                                              mutate(region = ifelse(region=="Riket","Sverige",region)),
                                         skickad_x_var = "Period",
                                         skickad_y_var = "arbetslöshet",
                                         skickad_x_grupp = "region",
                                         berakna_index=FALSE,
                                         manual_color = diagramfarger("rus_sex"),
                                         diagram_titel = diagram_titel,
                                         diagram_capt =  diagram_capt,
                                         output_mapp = output_mapp,
                                         stodlinjer_avrunda_fem = TRUE,
                                         manual_y_axis_title = "procent",
                                         visa_var_x_xlabel=1,
                                         filnamn_diagram = diagramfilnamn,
                                         skriv_till_diagramfil = spara_figur)
  
    # arbetslöshet_stapel <- SkapaStapelDiagram(skickad_df = arbetsmarknadsstatus_tidsserie %>% 
    #                                         filter(region%in%c("Dalarna","Riket")) %>% 
    #                                           mutate(region = ifelse(region=="Riket","Sverige",region)),
    #                                      skickad_x_var = "Period", 
    #                                      skickad_y_var = "arbetslöshet", 
    #                                      skickad_x_grupp = "region",
    #                                      berakna_index=FALSE,
    #                                      manual_color = diagramfarger("rus_sex"),
    #                                      manual_x_axis_text_vjust = 1,
    #                                      manual_x_axis_text_hjust = 1,
    #                                      diagram_titel = diagram_titel,
    #                                      diagram_capt =  diagram_capt,
    #                                      output_mapp = output_mapp,
    #                                      stodlinjer_avrunda_fem = TRUE,
    #                                      manual_y_axis_title = "procent",
    #                                      filnamn_diagram = diagramfilnamn,
    #                                      skriv_till_diagramfil = spara_figur)

  
```

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=8, fig.align='center',include = FALSE}
arbetslöshet_linje
```

```{r, include = FALSE}
 
  diagram_capt = "Källa: SCB:s öppna statistikdatabas, Befolkningens arbetsmarknadsstatus (BAS)\nBearbetning: Samhällsanalys, Region Dalarna" 

  diagram_titel <- paste0("Arbetslöshet i åldersgruppen 20-64 år i Dalarna")
  diagramfilnamn <- paste0("arbetslöshet_tidsserie.png")
  
  # arbetsmarknadsstatus_tidsserie$manad_long <- factor(arbetsmarknadsstatus_tidsserie$manad_long,levels  =c("januari","februari","mars","april","maj","juni","juli","augusti","september","oktober","november","december"))
  
  arb_df = arbetsmarknadsstatus_tidsserie %>% 
    filter(region%in%c("Dalarna")) %>% 
      mutate(region = ifelse(region=="Riket","Sverige",region),
              manad_long = str_to_title(manad_long)) %>% 
      mutate(manad_long = factor(.$manad_long,levels =c("Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December")))
    
  arbetslöshet_linje <- SkapaLinjeDiagram(skickad_df = arb_df,
                                         skickad_x_var = "manad_long", 
                                         skickad_y_var = "arbetslöshet", 
                                         skickad_x_grupp = "ar",
                                         berakna_index = FALSE,
                                         manual_color = diagramfarger("rus_sex"),
                                         lagga_till_punkter = TRUE,
                                         diagram_titel = diagram_titel,
                                         diagram_capt =  diagram_capt,
                                         output_mapp = output_mapp,
                                         stodlinjer_avrunda_fem = TRUE,
                                         manual_y_axis_title = "procent",
                                         visa_var_x_xlabel=1,
                                         filnamn_diagram = diagramfilnamn,
                                         skriv_till_diagramfil = spara_figur)
  
  # add geom_point to avregistrerade_linje with same colors
# arbetslöshet_linje <- arbetslöshet_linje + geom_point(data = arb_df ,
#                                           aes(x = manad_long,y = arbetslöshet,group=ar,color=ar), size=2.5)
# 
# if(spara_figur){
#   ggsave(paste0(output_mapp,diagramfilnamn), plot = arbetslöshet_linje, width = 12, height = 7)
# }

  
```

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=8, fig.align='center'}
arbetslöshet_linje
```

### Kommun {-}
```{r, include = FALSE}
 
mapp_scbadmgranser <- "G:/Samhällsanalys/GIS/grundkartor/KommunerDalarna/"
#G:\Samhällsanalys\GIS\grundkartor\Adm gränser med kustgränser
filnamn_kommuner <- "Dalarna_kommuner.shp"

sokvag_kommuner_sv <- paste0(mapp_scbadmgranser, filnamn_kommuner)

kommuner_sv <- st_read(sokvag_kommuner_sv)

#col.regions=colorRampPalette(c('deepskyblue', 'deepskyblue4')),

# ta ut endast kommuner och för senaste tillgängliga år
 arbetsloshet_kommun <- arbetsloshet_kommun %>%
     filter(månad == max(månad)) %>%
       filter(nchar(regionkod) == 4) %>%
         mutate(regionkod = as.integer(regionkod))

# lägg ihop kommunpolygonerna med brp per kommun-statistiken
arblosa_kommun_gis <- left_join(kommuner_sv, arbetsloshet_kommun, by = c("KOMMUNKOD" = "regionkod"))

 arblosa_kommun_gis$grupp <- factor(arblosa_kommun_gis$grupp,levels=c("0-1","1-2","2-3","3-4","4-5","5-6","6-7","7+"))
 
 arblosa_kommun_gis <- arblosa_kommun_gis %>% 
   mutate(arb_region=paste0(region,": ",arbetslöshet," %"))

 karta <- mapview(arblosa_kommun_gis,zcol = c("grupp"),
           col.regions=colorRampPalette(c('green', 'darkgreen')),
            popup = popupTable(arblosa_kommun_gis,
                          zcol = c("region","arbetslöshet")),
               layer.name = c("Arbetslöshet (%)"),
                  label = c("arb_region"))

  
```
Arbetslösheten bland Dalarnas kommuner är låg på många håll, där en majoritet av länets kommuner hade mellan 2 och 4 procents arbetslöshet i `r last(arbetsmarknadsstatus_tidsserie %>% filter(region=="Dalarna") %>% .$manad_long)` `r unique(last(arbetsmarknadsstatus_tidsserie %>% filter(region=="Dalarna") %>% .$ar))`. Lägst är arbetslösheten i  `r arbetsloshet_kommun %>% filter(månad==max(månad)) %>%  filter(arbetslöshet==min(arbetslöshet)) %>% .$region %>% .[1]`, med `r gsub("\\.",",",arbetsloshet_kommun %>% filter(månad==max(månad)) %>%  filter(arbetslöshet==min(arbetslöshet)) %>% .$arbetslöshet %>% .[1])` procent. I södra delarna av länet är bilden en annan, där flera kommuner har runt 6 procents arbetslöshet. Högst är arbetslösheten i  `r arbetsloshet_kommun %>% filter(månad==max(månad)) %>%  filter(arbetslöshet==max(arbetslöshet)) %>% .$region %>% .[1]`, där den uppgår till `r gsub("\\.",",",arbetsloshet_kommun %>% filter(månad==max(månad)) %>%  filter(arbetslöshet==max(arbetslöshet)) %>% .$arbetslöshet %>% .[1])` procent. En tänkbar orsak till detta mönster är att de kommuner med högst arbetslöshet också är de kommuner som har högst andel utrikes födda. Den sistnämnda gruppen tenderar att hamna i arbetslöshet i högre utsträckning än inrikes födda.

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=8, fig.align='center'}
karta
```

# Hushållens ekonomi

```{r, include = FALSE}
   diagram_capt = "Källa: Socialstyrelsen\nBearbetning: Samhällsanalys, Region Dalarna"

# Numrerar månadsnamn
ekonomiskt_bistand_df <- ekonomiskt_bistand_df %>% 
  mutate(manad = case_when(
    Månad == "Januari" ~ "01",
    Månad == "Februari" ~ "02",
    Månad == "Mars" ~ "03",
    Månad == "April" ~ "04",
    Månad == "Maj" ~ "05",
    Månad == "Juni" ~ "06",
    Månad == "Juli" ~ "07",
    Månad == "Augusti" ~ "08",
    Månad == "September" ~ "09",
    Månad == "Oktober" ~ "10",
    Månad == "November" ~ "11",
    Månad == "December" ~ "12",
  ))

# Beräknar ett startvärde (för att det skall funka med etiketterna i diagrammet)
#startvarde=paste0("2018","-",last(ekonomiskt_bistand_df$manad))

# Fixar lite med data
ekonomiskt_bistand_utskrift <- ekonomiskt_bistand_df %>% 
    mutate(ar_manad = paste0(År,"-",manad),
           antal_hushall = as.numeric(Antal.hushåll),
           variabel = "Antal hushåll" ) %>%
        select(-Antal.hushåll)

# ekonomiskt_bistand_jmf <-  ekonomiskt_bistand_utskrift %>% 
#   select(ar_manad,antal_hushall) %>% 
#     mutate(antal_hushall = mean(antal_hushall),
#            variabel = "Genomsnitt under perioden")
# 
# ut <- rbind(ekonomiskt_bistand_utskrift %>% select(ar_manad,variabel,antal_hushall),ekonomiskt_bistand_jmf)

  diagram_titel <- paste0("Antal hushåll med ekonomiskt bistånd i Dalarna, jan 2018 till ",tolower(substr(last(ekonomiskt_bistand_utskrift$Månad),1,3))," ",last(ekonomiskt_bistand_utskrift$År))
  diagram_titel = str_wrap(diagram_titel,40)
  diagramfilnamn <- paste0("ekonomiskt_bistand.png")
    
 eko_bistand_fig <- SkapaLinjeDiagram(skickad_df = ekonomiskt_bistand_utskrift,
                                         skickad_x_var = "ar_manad", 
                                         skickad_y_var = "antal_hushall",
                                         skickad_x_grupp = "variabel",
                                         berakna_index=FALSE,
                                         manual_color = c(diagramfarger("rus_sex")[1],"#000000"),
                                         diagram_titel = diagram_titel,
                                         diagram_capt =  diagram_capt,
                                         output_mapp = output_mapp,
                                         stodlinjer_avrunda_fem = TRUE,
                                         manual_y_axis_title = "Antal hushåll",
                                         legend_tabort = TRUE,
                                         visa_var_x_xlabel=12,
                                         filnamn_diagram = diagramfilnamn,
                                         skriv_till_diagramfil = spara_figur)


  
```

Hushållens ekonomiska situation kan mätas på flera olika sätt. Arbetslösheten, som diskuterades i föregående avsnitt, är en indikator. Hushåll där fler arbetar har helt enkelt en bättre ekonomi än hushåll där färre gör det. En annan indikator är den disponibla inkomsten, dvs. hur mycket varje hushåll har i plånboken (inkomst efter skatt och transfereringar). Tyvärr mäts den disponibla inkomsten med en betydande eftersläpning, varför vi i denna rapport istället valt att fokusera på hur många hushåll som har svårt att försörja sig, mätt i antalet hushåll som är i behov av ekonomiskt bistånd.

## Ekonomiskt bistånd

<details>

  <summary>Mer information om statistiken</summary>

<div title="Källa: Socialstyrelsen">Ekonomiskt bistånd är ett stöd som personer kan ansöka om i sin kommun om de har problem att försörja sig själva och sin familj. Ekonomiskt bistånd består av försörjningsstöd och bistånd till livsföringen i övrigt.</div> 
 
</details>

I Dalarna hade runt 4000 hushåll ett sådant behov under åren mellan 2018 och 2021, men därefter minskade behovet stadigt under en längre period. I `r last(ekonomiskt_bistand_utskrift$Månad)` `r last(ekonomiskt_bistand_utskrift$År)` var `r last(ekonomiskt_bistand_utskrift$antal_hushall)` hushåll i behov av ekonomiskt bistånd, vilket är något fler än i oktober 2023. Anmärkningsvärt är även att behovet av bistånd har minskat trots att prisnivån i samhället har ökat avsevärt på senare år (se avsnittet om inflation). Exakt vad den utvecklingen beror på är oklart, men ett antal tänkbara orsaker diskuteras i följande <a href = "https://www.svt.se/nyheter/inrikes/darfor-minskar-antalet-hushall-som-far-socialbidrag-i-sverige-forskare-forklarar-orsaker-bakom" target="_blank">artikel</a>. Värt att notera är även att antalet hushåll i Dalarna har ökat på senare år, från drygt 136 000 år 2018 till drygt 139 000 år 2022.   

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=8, fig.align='center'}
eko_bistand_fig
```

<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 10;"></div>

```{r, include = FALSE}

if(uppdatera_hemsida==TRUE){
# kopiera html-filen till 
file.copy(from = "laget_i_Dalarna.html", to = "docs/index.html", overwrite = TRUE)
file.copy(from = "laget_i_Dalarna.Rmd", to = "docs/index.Rmd", overwrite = TRUE)

# ska vi ta bort html-filen i projektmappen eller ha dubbelt, både där och i docs-mappen?
#file.remove("laget_i_Dalarna.html")
}
```